"use strict";(self.webpackChunksales_dashboard=self.webpackChunksales_dashboard||[]).push([[176],{4176:(e,a,t)=>{t.r(a),t.d(a,{default:()=>u});var s=t(5043),r=t(3216),l=t(7902),d=t(3693),n=t(5200),i=t(5130),o=t(5928),c=t(1793),h=t(2110),m=t(6125),g=t(9209),x=t(3633),b=t(579);const u=()=>{var e,a,t,u,p;const{shareId:f}=(0,r.g)(),v=(0,r.Zp)(),{darkMode:y}=(0,l.DP)(),{transformDataForSharing:w}=(0,d.Ex)(),{setSalesData:N,setSelectedProducts:j,setSelectedRetailers:D,setDateRange:S,setStartDate:k,setEndDate:T,setSelectedMonth:C}=(0,n.Ez)(),[A,M]=(0,s.useState)(null),[R,E]=(0,s.useState)(!0),[L,P]=(0,s.useState)(null),[F,I]=(0,s.useState)(null),[V,$]=(0,s.useState)(!1),[z,J]=(0,s.useState)(!0),[O,B]=(0,s.useState)(null),[U,H]=(0,s.useState)("Client Dashboard");(0,s.useEffect)((()=>{(async()=>{try{if(!f)throw new Error("No share ID provided");E(!0);const s=!(/[+/]/.test(e=f)||e.length>40);let r;J(s);let l=!1;if(console.log("Loading shared dashboard with ID:",f),console.log("Using Supabase mode:",s),s)try{console.log("Using Supabase to fetch dashboard");const e=await x.A.getSharedDashboard(f);l=e.expired,r=e.config,console.log("Supabase result:",e)}catch(a){console.error("Supabase fetch failed, trying fallback:",a);try{let e=f;for(;e.length%4!==0;)e+="=";const a=JSON.parse(atob(e));if(r=a,a.expiryDate){const e=new Date(a.expiryDate);l=e<new Date}J(!1),console.log("Fallback decode successful:",r)}catch(t){throw console.error("Fallback decode failed:",t),new Error("Invalid or corrupted share link")}}else{console.log("Using fallback mode to fetch dashboard");try{let e=f;for(;e.length%4!==0;)e+="=";const a=JSON.parse(atob(e));if(r=a,a.expiryDate){const e=new Date(a.expiryDate);l=e<new Date}console.log("Fallback decoded config:",r)}catch(a){throw console.error("Error decoding fallback share:",a),new Error("Invalid or corrupted share link")}}if(l)return $(!0),P(r),void E(!1);P(r),r.activeTab&&r.allowedTabs&&r.allowedTabs.includes(r.activeTab)?(console.log("Setting active tab to config value:",r.activeTab),I(r.activeTab)):r.allowedTabs&&r.allowedTabs.length>0?(console.log("Setting active tab to first allowed tab:",r.allowedTabs[0]),I(r.allowedTabs[0])):(console.log("No valid tabs found, defaulting to summary"),I("summary")),console.log("Shared dashboard configuration:",{activeTab:r.activeTab,allowedTabs:r.allowedTabs,setActiveTabTo:F});const d=(e=>{var a,t,s,r;return null!==(a=e.metadata)&&void 0!==a&&a.clientName?e.metadata.clientName:null!==(t=e.metadata)&&void 0!==t&&t.brandNames&&e.metadata.brandNames.length>0?e.metadata.brandNames.join(", "):e.brandNames&&e.brandNames.length>0?e.brandNames.join(", "):null!==(s=e.precomputedData)&&void 0!==s&&s.clientName?e.precomputedData.clientName:null!==(r=e.precomputedData)&&void 0!==r&&r.brandNames&&e.precomputedData.brandNames.length>0?e.precomputedData.brandNames.join(", "):"Client"})(r);if(H(d+" Dashboard"),console.log("Set client display name to:",d+" Dashboard"),r.precomputedData){const e=JSON.parse(JSON.stringify(r.precomputedData));e.clientName&&"Client"!==e.clientName||(e.clientName=d);const a=(e=>{var a,t,s,r,l,d,n,i;return{...e,getFilteredData:()=>e.filteredData||[],calculateMetrics:()=>e.metrics||null,getRetailerDistribution:()=>e.retailerData||[],getProductDistribution:()=>e.productDistribution||[],isSharedView:!0,hasData:Boolean((null===(a=e.filteredData)||void 0===a?void 0:a.length)||(null===(t=e.salesData)||void 0===t?void 0:t.length)),selectedProducts:(null===(s=e.filters)||void 0===s?void 0:s.selectedProducts)||["all"],selectedRetailers:(null===(r=e.filters)||void 0===r?void 0:r.selectedRetailers)||["all"],dateRange:(null===(l=e.filters)||void 0===l?void 0:l.dateRange)||"all",startDate:(null===(d=e.filters)||void 0===d?void 0:d.startDate)||"",endDate:(null===(n=e.filters)||void 0===n?void 0:n.endDate)||"",selectedMonth:(null===(i=e.filters)||void 0===i?void 0:i.selectedMonth)||"",setSelectedProducts:()=>{},setSelectedRetailers:()=>{},setDateRange:()=>{},setActiveTab:()=>{}}})({...e,filters:r.filters||{},brandMapping:e.brandMapping||{},brandNames:e.brandNames||[],clientName:d,shareConfig:r,isSharedView:!0});console.log("Setting client data from precomputedData:",a),B(a),e.salesData&&Array.isArray(e.salesData)&&(console.log("Setting salesData in DataContext from precomputedData"),N(e.salesData))}else console.warn("No precomputed data found in share config");r.filters&&(r.filters.selectedProducts&&j(r.filters.selectedProducts),r.filters.selectedRetailers&&D(r.filters.selectedRetailers),r.filters.dateRange&&S(r.filters.dateRange),r.filters.startDate&&k(r.filters.startDate),r.filters.endDate&&T(r.filters.endDate),r.filters.selectedMonth&&C(r.filters.selectedMonth)),E(!1)}catch(a){console.error("Error loading shared dashboard:",a),M("Invalid or expired share link"),E(!1)}var e})()}),[f,N,j,D,S,k,T,C]);if(R)return(0,b.jsx)("div",{className:`min-h-screen ${y?"bg-gray-900 text-white":"bg-gray-50 text-gray-900"} flex items-center justify-center p-4`,children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"inline-block w-8 h-8 border-t-2 border-b-2 border-pink-600 rounded-full animate-spin"}),(0,b.jsx)("p",{className:"mt-4",children:"Loading shared dashboard..."})]})});if(A)return(0,b.jsx)("div",{className:`min-h-screen ${y?"bg-gray-900 text-white":"bg-gray-50 text-gray-900"} flex items-center justify-center p-4`,children:(0,b.jsxs)("div",{className:"w-full max-w-md p-6 rounded-lg shadow-lg "+(y?"bg-gray-800":"bg-white"),children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"Error Loading Dashboard"}),(0,b.jsx)("p",{className:"mb-4",children:A}),(0,b.jsx)("button",{onClick:()=>v("/"),className:"px-4 py-2 bg-pink-600 text-white rounded-md hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-pink-500",children:"Go to Dashboard"})]})});var W;if(V)return(0,b.jsx)("div",{className:`min-h-screen ${y?"bg-gray-900 text-white":"bg-gray-50 text-gray-900"} flex items-center justify-center p-4`,children:(0,b.jsxs)("div",{className:"w-full max-w-md p-6 rounded-lg shadow-lg "+(y?"bg-gray-800":"bg-white"),children:[(0,b.jsx)("div",{className:"text-amber-500 mb-4",children:(0,b.jsx)("svg",{className:"h-12 w-12 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,b.jsx)("h2",{className:"text-xl font-bold text-center mb-4",children:"This Dashboard Link Has Expired"}),(0,b.jsxs)("p",{className:"text-center mb-6",children:["Please contact ",(null===(W=L.branding)||void 0===W?void 0:W.companyName)||"the dashboard owner"," for an updated link."]})]})});if(!L)return(0,b.jsx)("div",{className:`min-h-screen ${y?"bg-gray-900 text-white":"bg-gray-50 text-gray-900"} flex items-center justify-center p-4`,children:(0,b.jsxs)("div",{className:"w-full max-w-md p-6 rounded-lg shadow-lg "+(y?"bg-gray-800":"bg-white"),children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-center mb-4",children:"Dashboard Not Found"}),(0,b.jsx)("p",{className:"text-center mb-6",children:"The dashboard you're looking for doesn't exist or may have been deleted."})]})});if(!O)return console.error("Missing client data for shared dashboard"),(0,b.jsx)("div",{className:`min-h-screen ${y?"bg-gray-900 text-white":"bg-gray-50 text-gray-900"} flex items-center justify-center p-4`,children:(0,b.jsxs)("div",{className:"w-full max-w-md p-6 rounded-lg shadow-lg "+(y?"bg-gray-800":"bg-white"),children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"Error Loading Dashboard Data"}),(0,b.jsx)("p",{className:"mb-4",children:"The dashboard data could not be loaded."})]})});const _=w?w({...O,shareConfig:L}):O,G=(null===_||void 0===_||null===(e=_.filteredData)||void 0===e?void 0:e.length)>0||(null===_||void 0===_||null===(a=_.salesData)||void 0===a?void 0:a.length)>0;return(0,b.jsxs)("div",{className:"min-h-screen "+(y?"bg-gray-900":"bg-gray-50"),children:[!1,(0,b.jsx)("header",{className:"w-full border-b "+(y?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between",children:(0,b.jsxs)("div",{className:"flex items-center",children:[(null===(t=L.branding)||void 0===t?void 0:t.showLogo)&&(0,b.jsx)("div",{className:"h-10 w-10 rounded-full mr-3 flex items-center justify-center",style:{backgroundColor:L.branding.primaryColor||"#FF0066"},children:(0,b.jsx)("span",{className:"text-white font-bold text-lg",children:(L.branding.companyName||"C").slice(0,1)})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-semibold "+(y?"text-white":"text-gray-900"),children:U}),(0,b.jsxs)("p",{className:"text-sm "+(y?"text-gray-400":"text-gray-500"),children:["Shared by ",(null===(u=L.branding)||void 0===u?void 0:u.companyName)||"Shopmium Insights"]})]})]})})}),(0,b.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[L.clientNote&&(0,b.jsx)("div",{className:"mb-6 p-4 rounded-lg "+(y?"bg-blue-900/20 text-blue-300":"bg-blue-50 text-blue-800"),children:(0,b.jsx)("p",{children:L.clientNote})}),L.allowedTabs&&L.allowedTabs.length>1&&(0,b.jsx)("div",{className:"mb-6 border-b "+(y?"border-gray-700":"border-gray-200"),children:(0,b.jsx)("div",{className:"flex flex-wrap",children:L.allowedTabs.map((e=>(0,b.jsx)("button",{onClick:()=>(e=>{console.log("Changing active tab to:",e),e&&L.allowedTabs.includes(e)&&I(e)})(e),className:"py-3 px-4 border-b-2 font-medium text-sm whitespace-nowrap "+(F===e?"border-pink-500 "+(y?"text-pink-400":"text-pink-600"):"border-transparent "+(y?"text-gray-400 hover:text-gray-300":"text-gray-500 hover:text-gray-700")),children:(0,b.jsx)("span",{className:"capitalize",children:e})},e)))})}),(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg "+(G?"":"p-6"),children:G?(0,b.jsx)(g.A,{children:(0,b.jsxs)(i.Rz,{clientData:_,children:["summary"===F&&(0,b.jsx)(g.A,{children:(0,b.jsx)(o.A,{isSharedView:!0})}),"sales"===F&&(0,b.jsx)(g.A,{children:(0,b.jsx)(c.A,{isSharedView:!0})}),"demographics"===F&&(0,b.jsx)(g.A,{children:(0,b.jsx)(h.A,{isSharedView:!0})}),"offers"===F&&(0,b.jsx)(g.A,{children:(0,b.jsx)(m.A,{isSharedView:!0})})]})}):(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),(0,b.jsx)("h3",{className:"mt-2 text-base font-medium "+(y?"text-white":"text-gray-900"),children:"No data available"}),(0,b.jsx)("p",{className:"mt-1 text-sm "+(y?"text-gray-400":"text-gray-500"),children:"There is no data to display with the current filters."})]})})]}),(0,b.jsx)("footer",{className:"w-full border-t "+(y?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,b.jsx)("div",{className:"flex items-center",children:(0,b.jsxs)("span",{className:"text-sm "+(y?"text-gray-400":"text-gray-500"),children:["Shared with you by ",(null===(p=L.branding)||void 0===p?void 0:p.companyName)||"Shopmium Insights"]})})})})]})}}}]);
//# sourceMappingURL=176.a1762895.chunk.js.map