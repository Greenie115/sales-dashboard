"use strict";(self.webpackChunksales_dashboard=self.webpackChunksales_dashboard||[]).push([[176],{4176:(e,a,s)=>{s.r(a),s.d(a,{default:()=>u});var t=s(5043),r=s(3216),l=s(7902),i=s(5130),d=s(7968),n=s(972),o=s(5889),c=s(2837),h=s(2110),m=s(3522),x=s(9209),g=s(864),b=s(579);const u=()=>{var e;const{shareId:a}=(0,r.g)(),s=(0,r.Zp)(),{darkMode:u}=(0,l.DP)(),[p,f]=(0,t.useState)(null),[y,w]=(0,t.useState)(!0),[j,v]=(0,t.useState)("summary"),[N,S]=(0,t.useState)(!1),[k,A]=(0,t.useState)({filterParams:null,dataSnapshot:null,allowedTabs:["summary","sales","demographics","offers"]}),[D,T]=(0,t.useState)("Shared Dashboard"),[C,P]=(0,t.useState)(!1),[E,M]=(0,t.useState)(!0);(0,t.useEffect)((()=>{(async()=>{M(!0);const{data:{session:e}}=await d.A.auth.getSession();P(!!e),M(!1)})()}),[s]),(0,t.useEffect)((()=>{E||(C?(async()=>{w(!0),f(null),S(!1);try{if(!a)throw new Error("No share ID provided");console.log("Fetching shared dashboard with ID:",a);const e=await g.A.getSharedDashboard(a);if(console.log("Result from getSharedDashboard:",e),e.expired)return console.log("Dashboard has expired"),void S(!0);if(!e.shareConfig)return console.error("Missing share configuration in result:",e),void f("Shared dashboard data is invalid or incomplete.");const s=e.shareConfig;if(console.log("Processing share configuration:",s),!s.precomputedData)return console.error("Missing precomputed data in share config"),void f("Shared dashboard is missing required data.");A((e=>({...e,filterParams:s.filters||{},dataSnapshot:s.precomputedData||{},allowedTabs:Array.isArray(s.allowedTabs)?s.allowedTabs:["summary"],activeTab:s.activeTab||"summary"}))),console.log("Client data set successfully"),s.activeTab&&s.allowedTabs&&Array.isArray(s.allowedTabs)&&s.allowedTabs.includes(s.activeTab)?(v(s.activeTab),console.log(`Active tab set to: ${s.activeTab}`)):(v("summary"),console.log("Active tab defaulted to summary"));let t="Shared Dashboard";s.clientName?t=s.clientName:s.metadata&&s.metadata.clientName?t=s.metadata.clientName:s.metadata&&Array.isArray(s.metadata.brandNames)&&s.metadata.brandNames.length>0&&(t=s.metadata.brandNames.join(", ")),T(t),console.log(`Client display name set to: ${t}`),console.log("Dashboard loaded successfully")}catch(e){console.error("Error loading shared dashboard:",e),f(e.message||"Failed to load shared dashboard."),A((e=>({...e,filterParams:null,dataSnapshot:null})))}finally{w(!1)}})():(w(!1),f("Authentication required to view this dashboard."),console.log("User not authenticated, cannot load shared view.")))}),[a,E,C]);const L=!y&&!p&&!N&&(!k.dataSnapshot||!k.filterParams);(0,t.useEffect)((()=>{L&&(console.error("Snapshot data is missing after successful load attempt",k),f("Shared dashboard data is incomplete or missing."))}),[L]);const V=(0,t.useMemo)((()=>{if(k.dataSnapshot&&k.filterParams){const e=(0,n.El)(k.dataSnapshot);return{filteredData:k.dataSnapshot,filters:k.filterParams,metrics:e,isSharedView:!0}}return null}),[k.dataSnapshot,k.filterParams]),$=!(null===V||void 0===V||null===(e=V.filteredData)||void 0===e||!e.length);return E||y?(0,b.jsx)("div",{className:`min-h-screen ${u?"bg-gray-900 text-white":"bg-gray-50 text-gray-900"} flex items-center justify-center p-4`,children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"inline-block w-8 h-8 border-t-2 border-b-2 border-pink-600 rounded-full animate-spin"}),(0,b.jsx)("p",{className:"mt-4",children:E?"Checking authentication...":"Loading shared dashboard..."})]})}):p?(0,b.jsx)("div",{className:`min-h-screen ${u?"bg-gray-900 text-white":"bg-gray-50 text-gray-900"} flex items-center justify-center p-4`,children:(0,b.jsxs)("div",{className:"w-full max-w-md p-6 rounded-lg shadow-lg "+(u?"bg-gray-800":"bg-white"),children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"Error Loading Dashboard"}),(0,b.jsx)("p",{className:"mb-4",children:p}),(0,b.jsx)("button",{onClick:()=>s("/"),className:"px-4 py-2 bg-pink-600 text-white rounded-md hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-pink-500",children:"Go to Dashboard"})]})}):N?(0,b.jsx)("div",{className:`min-h-screen ${u?"bg-gray-900 text-white":"bg-gray-50 text-gray-900"} flex items-center justify-center p-4`,children:(0,b.jsxs)("div",{className:"w-full max-w-md p-6 rounded-lg shadow-lg "+(u?"bg-gray-800":"bg-white"),children:[(0,b.jsx)("div",{className:"text-amber-500 mb-4",children:(0,b.jsx)("svg",{className:"h-12 w-12 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,b.jsx)("h2",{className:"text-xl font-bold text-center mb-4",children:"This Dashboard Link Has Expired"}),(0,b.jsx)("p",{className:"text-center mb-6",children:"Please contact the person who shared this link for an updated version."})]})}):(0,b.jsxs)("div",{className:"min-h-screen "+(u?"bg-gray-900":"bg-gray-50"),children:[(0,b.jsx)("header",{className:"w-full border-b "+(u?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between",children:(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:"h-10 w-10 rounded-full mr-3 flex items-center justify-center bg-pink-600",children:(0,b.jsx)("span",{className:"text-white font-bold text-lg",children:"S"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-xl font-semibold "+(u?"text-white":"text-gray-900"),children:D}),(0,b.jsx)("p",{className:"text-sm "+(u?"text-gray-400":"text-gray-500"),children:"Shared Dashboard "})]})]})})}),(0,b.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[k.allowedTabs&&k.allowedTabs.length>1&&(0,b.jsx)("div",{className:"mb-6 border-b "+(u?"border-gray-700":"border-gray-200"),children:(0,b.jsx)("div",{className:"flex flex-wrap",children:k.allowedTabs.map((e=>(0,b.jsx)("button",{onClick:()=>(e=>{var a;console.log("Changing active tab to:",e),e&&null!==(a=k.allowedTabs)&&void 0!==a&&a.includes(e)&&v(e)})(e),className:"py-3 px-4 border-b-2 font-medium text-sm whitespace-nowrap "+(j===e?"border-pink-500 "+(u?"text-pink-400":"text-pink-600"):"border-transparent "+(u?"text-gray-400 hover:text-gray-300":"text-gray-500 hover:text-gray-700")),children:(0,b.jsx)("span",{className:"capitalize",children:e})},e)))})}),(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg "+($?"":"p-6"),children:$?(0,b.jsx)(x.A,{children:(0,b.jsxs)(i.Rz,{clientData:V,children:["summary"===j&&(0,b.jsx)(x.A,{children:(0,b.jsx)(o.A,{isSharedView:!0})}),"sales"===j&&(0,b.jsx)(x.A,{children:(0,b.jsx)(c.A,{isSharedView:!0})}),"demographics"===j&&(0,b.jsx)(x.A,{children:(0,b.jsx)(h.A,{isSharedView:!0})}),"offers"===j&&(0,b.jsx)(x.A,{children:(0,b.jsx)(m.A,{isSharedView:!0})})]})}):(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),(0,b.jsx)("h3",{className:"mt-2 text-base font-medium "+(u?"text-white":"text-gray-900"),children:"No data available"}),(0,b.jsx)("p",{className:"mt-1 text-sm "+(u?"text-gray-400":"text-gray-500"),children:"There is no data to display with the current filters."})]})})]}),(0,b.jsx)("footer",{className:"w-full border-t "+(u?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,b.jsx)("div",{className:"flex items-center",children:(0,b.jsx)("span",{className:"text-sm "+(u?"text-gray-400":"text-gray-500"),children:"Shared Dashboard View"})})})})]})}}}]);
//# sourceMappingURL=176.d4979f4d.chunk.js.map